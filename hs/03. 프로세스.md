# Chapter 3. 프로세스

## 3.1 프로세스 개념

프로세스: 실행 중인 프로그램 (실행중인 프로그램만 프로세스, 프로그램 그 자체는 프로세스가 아님)

- 프로세스 스택, 데이터 섹션, 메모리 힙을 포함
- 실행파일이 메모리에 적재된 상태
- 동일한 실행 파일에 대한 개별 인스턴스를 가질 수 있음

**프로세스 상태**

- **새로운(New)**: 프로세스 생성 중
- **실행(Running)**: 명령어 실행 되고 있음
- **대기(Waiting)**: 어떤 사견(입출력 완료, 신호 수신 등)이 일어나길 기다림
- **준비 완료(Ready)**: 처리기에 할당되기를 기다림
- **종료(Terminated)**: 실행 종료

이름은 운영체제마다 다를 수 있음.

프로세스 제어 블록 (PCB)

프로세스는 운영체제에서 `프로세스 제어 블록(PCB)`에 의해 표현됨.  PCB는 다음과 같은 정보를 포함:

- 프로세스 상태
- 프로그램 카운터
- CPU 레지스터들
- CPU 스케줄링 정보
- 메모리 관리 정보
- 회계 정보
- 입출력 상태 정보

## 3.2 프로세스 스케줄링

**스케쥴링 큐:**

- **잡 큐**: 모든 프로세스 관리
- **준비 완료 큐**: “준비 완료” 상태 프로세스들을 관리
- **장치 큐**: “대기” 상태 프로세스 관리

**스케줄러**: 프로세스가 큐 사이를 오가는 사이클 주기를 관리

**컨텍스트 스위치**: 프레세스가 중단 되었다가 다시 실행되기 위해 현재 context를 저장해 두었다 다시 재개하는 작업

**프로세스 처리 순서**

1. 새로운 프로세스를 준비 완료 큐에 넣음
2. 사건(event)에 따라 다음 중의 하나가 발생
    1. 입출력 요청을 하여 입출력 큐로 이동
    2. 자식 프로세스를 생성하고 자식 프로세스의 종료를 기다림
    3. 인터럽트의 결과에 의해 강제로 CPU로부터 제거
3. 다시 준비 완료 큐로 이동
4. 프로세스 종료시 까지 1 - 3 의 주기가 계속 됨

## 3.3 프로세스에 대한 연산

**프로세스 생성**

- 프로세스는 자식 프로세스를 생성 할 수 있고, 트리 형태로 관리됨
- 대부분의 현대 운영체제는 프로세스 식별자(pid)를 통해 프로세스를 구분

**프로세스 종료**

- 프로세스가 마지막 문장의 실행을 끝내고, exit() 시세틈 호출을 사용하여 운영체제에게 자신의 삭제를 요청
- 모든 자원 (메모리, 입출력 버퍼 등)을 운영체제에 반납
- 부모는 자식 프로세스를 임의로 종료할 수 있음

## 3.4 프로세스 간 통신

**프로세스간의 협력(통신)을 허용하는 이유:**

- **정보 공유**: 여러 사용자가 동일한 정보에 흥미를 가질 수  있기에, 병행적 접근을 허용할 수 있어야함
- **계산 가속화**: 특정 테스크를 빨리 실행하기 위해 서브 테스크로 나누어 병렬로 처리
- **모듈성**: 모듈 형태로 시스템을 구성
- **편의성**: 편집, 음악 듣기, 컴파일 등 한 사용자가 여러 작업을 동시에 병렬 수행

**프로세스 간 통신 기법**

- **공유 메모리**: 협력 프로세스들에 의해 공유되는 메모리 영역을 구축.
- **메시지 전달**: 메시지를 통해 정보 교환 (ex. ipc 통신). 공유 메모리 방식보다 느리지만 구현하기가 쉽고, 멀티 코어 시스템에서 더 좋은 성능을 보임
    - 명명 (Naming)
        - 직접 통신: 수신자와 송신자의 이름을 명시하여 직접 통신
        - 간접 통신 송신자가 mailbox로 메시지를 전달하면 수신자가 mailbox로 부터 간접적으로 메시지를 받음
    - 동기화 (Synchronization)
        - **봉쇄형 송신**: 송신하는 프로세스는 메시지가 수신될때까지 봉쇄
        - **비봉쇄형 송신**: 송신하는 프로세스가 메시지를 보내고 작업을 재시작
        - **봉쇄형 수신**: 수신자는 메시지가 도착할 때까지 봉쇄
        - **비봉쇄형 수신**: 수신자는 유효한 메시지를 받거나 널을 받음
    - 버퍼링 (Buffering)
        - **무용량**: 큐의 최대 길이가 0. 대기 메시지를 가질 수 없고 송신자는 수신자가 메시지를 수신할때까지 대기
        - **유한 용량**: 큐는 n의 유한한 길이를 가짐. 메시지는 큐에 놓이며, 송신자는 대기하지 않고 실행을 계속 함. 단, 큐가 만원이면 봉쇄.
        - **무한 용량**: 유한 용량이랑 같으나 큐 길이가 무한.

## 3.6 클라이언트 서버 환경에서 통신

- **소켓**
    - 통신의 극점으로 정의
    - 프로세스 두 개가 통신할 때에 두 개의 소켓이 만들어지고 통신 채널 양단에 하나씩 배정
- **원격 프로시저 호출 (RPC)**
    - 네트워크에 연결되어 있는 두 시스템 사이의 통신에 사용하기 위해, 프로시저 호출 기법을 분리해 생각하기 위한 방편으로 설계
    - IPC와 유사하며, IPC 기반 위에 만들어짐 (원격 프로세스끼리의 자원 공유)
    - 네트워크 연결 때문에 실패할 수 있기 때문에, 최대 한번 실행되는 것이 아닌, 정확히 한번 처리되도록 보장 해야함
- **파이프**
    - 두 프로세스가 통신할 수 있게 하는 전달자로서 작동. 프로세스끼리 서로 통신할 수 있는 생다적으로 간단한 방법 제공
    - **일반 파이프**: 생산자-소비자(부모-자식) 형태로 두 프로세스 간의 통신을 허용 (단방향 통신만 가능)
    - **지명 파이프**: 서로 무관한 프로세스 간의 통신을 허용 (양방향 통신 가능)