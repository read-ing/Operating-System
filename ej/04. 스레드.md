# 04. 스레드

### 스레드

- CPU 이용의 기본 단위
- 스레드ID, 프로그램 카운터, 레지스터 집합, 스택으로 구성
- 하나의 프로세스를 다수의 실행 단위로 구분하여 자원을 공유하고 자원의 생성과 관리의 중복성을 최소화하여 수행 능력을 향상 시킨다.
- 전통적인 스레드는 하나의 제어 스레드를 가지고 있고, 다수의 제어 스레드를 가진 프로세스는 동시에 하나 이상의 작업들을 수행할 수 있다.

### 다중 스레드 프로그래밍

현대의 컴퓨터에서 동작하는 거의 모둔 소프트웨어 응용들은 다중 스레드를 이용한다.

예를 들어 웹 서버는 여러 클라이언트들이 병행하게 접근할 수 있다.

스레드가 대중화되기 전에는 서버에게 서비스 요청이 들어오면 프로세스는 그 요청을 수행할 별도의 프로세스를 생성하는 방식으로 서버가 하나의 프로세스로 동작하게끔하여 서비스 시간을 단축했다.

하지만 새 프로세스가 할 일이 기존의 프로세스가 하는 일과 동일하다면 새 프로세스를 만드는 것이 비효율적이으로, 프로세스 안에 여러 스레드를 만들어 나가는 방법으로 바뀌었다.

요청이 들어오면, 다른 프로세스를 생성하는 것이 아니라, 요청을 서비스할 새로운 스레드를 생성하고 추가적인 요청을 listen하기 위한 작업을 재개한다.

### 다중 스레드 프로그래밍의 장점

- **`응답성`**: 프로그램의 일부분이 중단되거나 긴 작업을 수행하더라도 프로그램의 수행이 계속되어 사용자에 대한 응답성이 증가한다.
- **`자원 공유`**: 프로세스는 공유 메모리와 메시지 전달 기법을 통해서만 자원을 공유할 수 있지만 스레드는 자동으로 그들이 속한 프로세스의 자원들과 메모리를 공유한다.
- **`경제성`**: 프로세스 내 자원들과 메모리를 공유하기 때문에 스레드를 생성하고 문맥 교환하는 것이 보다 더 경제적이다.
- **`규모 적응성`**: 다중 처리기 구조에서는 각각의 스레드가 다른 처리기에서 병렬로 수행될 수 있기 때문에 병렬성이 증가한다.

### 다중코어 프로그래밍

코어가 여러 CPU 칩 형태를 띠거나 칩 안에 여러 개가 존재하는 시스템을 다중코어 또는 다중 처리기 시스템이라고 부른다.

- 단일 코어 시스템에서의 병행성은 단순히 스레드의 실행이 시간에 따라 교대로 실행된다는 것을 의미한다.(병행실행)
- 다중 코어 시스템에서의 병행성은 스레드들이 병렬적으로 실행될 수 있다는 것을 뜻한다.(병렬실행)

병렬 실행 없이 병행 실행 가능

### 병렬 실행의 유형

- **`데이터 병렬 실행`**: 동일한 연산을 나누어 실행
- **`태스크 병렬 실행`**: 스레드를 다수의 코어에 분배. 각 스레드는 고유의 연산을 실행

### 다중 스레드 모델

- 사용자 스레드
  - 사용자 수준에서 스레드를 위한 지원 제공
  - 커널 위에서 지원, 커널 지원없이 관리된다.
- 커널 스레드
  - 커널 수준에서 스레드를 위한 지원 제공
  - 운영체제에 의해 직접 지원되고 관리된다.

1. **다대일 모델**

여러 사용자 스레드를 하나의 커널 스레드로 사상하는 방식

한 번에 하나의 스레드만이 커널에 접근할 수 있기 때문에 병렬로 실행될 수 없다.

2. **일대일 모델** - Windows, Linux

각 사용자 스레드를 각각 하나의 커널 스레드로 사상하는 방식

하나의 스레드가 봉쇄형 시스템 호출을 호출하더라도 다른 스레드가 실행될 수 있으므로 높은 병렬성 제공

사용자 스레드를 생성할 때마다 커널 스레드를 생성해야 한느데, 커널 스레드를 생성하는 오버헤드가 응용 프로그램의 성능을 저하시킬 수 있다.

3. **다대다 모델**

여러 사용자 스레드를 여러 커널 스레드로 사상하는 방식

4. **두 수준 모델**

다대다 모델의 변형, 한 사용자 스레드가 하나의 커널 스레드에만 연관되는 것을 허용
